$(function() {
	(function() {
		$(".validation-cancel").on("click", function() {
			$.colorbox.close()
		});
		var hasPosition = $("#hasPosition").val();
		$("#weixin-show,.weixin-box,.mobileqr").on("click", function() {
			if (hasPosition != null && hasPosition == "true") {
				validationBox()
			} else {
				$.colorbox({
					inline: true,
					href: "#novalidation",
					title: "生成招聘幻灯片"
				})
			}
		});
		$(".slider-delete").on("click", function() {
			$("#validation-mask").hide();
			$("#companySlider").hide()
		});
		$(".content-activity-banner .share-btn,.content-activity-banner .share-btn-free, .weixin-noneshare .share-btn").on("click", function() {
			if (hasPosition != null && hasPosition == "true") {
				validationBox()
			} else {
				$.colorbox({
					inline: true,
					href: "#novalidation",
					title: "生成招聘幻灯片"
				})
			}
		});
		var oldShareScore = +$("#oldShareScore").val();
		var shareScore = +$("#shareScore").val();
		var diffScore = shareScore - oldShareScore;
		var delay = 1700;
		var startDelay = 1200;
		var targetChangeText = $(".weixin-share .score");
		if (shareScore != oldShareScore) {
			var changeGap = 40;
			window.setTimeout(function() {
				var start = oldShareScore;
				targetChangeText.text(start);
				var timer = window.setInterval(function() {
					if (start == shareScore) {
						window.clearInterval(timer);
						return
					}
					diffScore > 0 ? (++start) : (--start);
					targetChangeText.text(start)
				}, changeGap)
			}, startDelay)
		}
	})();

	function validationBox() {
		var companyId = $("#companyId").val();
		$("#validation-mask").show();
		$("#companySlider").show();
		$("#weixnBox").attr("src", "http://c.lagou.com/cs/march/show/" + companyId + ".html?view=pc")
	}
	$(window).resize(function() {
		var colorbox = $("#colorbox");
		var sInput;
		var oPop = colorbox.find("#cboxLoadedContent").children(":first");
		if (oPop.attr("id") == "noticeInterview") {
			sInput = "datetimepicker"
		} else {
			if (oPop.attr("id") == "hasOfflineNotice") {
				sInput = "mianshiYear"
			}
		}
		var oInput = $("#" + sInput);
		var dateDiv = $("#ui-datepicker-div");
		var n = 0;
		if (!dateDiv.is(":hidden")) {
			dateDiv.css({
				opacity: 0
			});
			setTimeout(function() {
				initPickerXY(oInput, dateDiv)
			}, 500)
		}
	});

	function initPickerXY(oInput, dateDiv) {
		var l = parseInt(oInput.offset().left, 10) + "px";
		var t = parseInt(oInput.offset().top, 10) + 31 + "px";
		dateDiv.css({
			left: l,
			top: t,
			opacity: 1
		})
	}
	offlineNotice();

	function offlineNotice() {
		var cityul = $(".resume_header2");
		for (var i = 0; i < cityul.length; i++) {
			cityul[i].onmouseover = function(e) {
				var e = e || window.event;
				var Target = e.srcElement || e.target;
				if (Target.tagName.toUpperCase() == "EM") {
					$(this).find("span.offline_tips_con").css("display", "block")
				}
			};
			cityul[i].onmouseout = function(e) {
				var e = e || window.event;
				var Target = e.srcElement || e.target;
				if (Target.tagName.toUpperCase() == "EM") {
					$(this).find("span.offline_tips_con").css("display", "none")
				}
			}
		}
	}
	$(".isVacation").on("click", "a#holiday_how", holidayHow);
	var select_holiday_timeBtn = $("#select_holiday_timeBtn");
	select_holiday_timeBtn.click(function() {
		$("#select_holiday_time").slideUp();
		$("#holiday_time").slideDown();
		$("#holiday_begintime").val(GetDateStr(1));
		$("#holiday_endtime").val(GetDateStr(8));
		$(".isVacation").off("click", "a#holiday_how")
	});

	function GetDateStr(AddDayCount) {
		var dd = new Date();
		dd.setDate(dd.getDate() + AddDayCount);
		var y = dd.getFullYear();
		var m = (dd.getMonth() + 1) < 10 ? "0" + (dd.getMonth() + 1) : (dd.getMonth() + 1);
		var d = dd.getDate() < 10 ? "0" + dd.getDate() : dd.getDate();
		return y + "-" + m + "-" + d
	}
	var todayDate = new Date();
	var holiday_begintime = todayDate.getFullYear() + "-" + (todayDate.getMonth() + 1) + "-" + todayDate.getDate();
	$("#holiday_begintime").val(GetDateStr(1));
	$("#holiday_endtime").val(GetDateStr(8));
	var fromDate, endDate;
	$("#holiday_begintimeBtn").click(function() {
		var begin_day = $("#holiday_begintime").val();
		var end_day = $("#holiday_endtime").val();
		$.ajax({
			type: "post",
			data: {
				fromDate: begin_day,
				endDate: end_day
			},
			url: ctx + "Company/holiday",
			dataType: "JSON"
		}).done(function(result) {
			//result = $.parseJSON( result );
			if (result.state == 1) {
				$("#confirm_htime").slideDown();
				$("#holiday_time").slideUp();
				//console.log(result.content.data.vacation);
				//var vacation = eval("(" + result.content.data.vacation + ")");
				var vacation = result.content.data.vacation;
				fromDate = vacation.fromDate;
				endDate = vacation.endDate;
				$(".cha").text(vacation.intervalDays);
				$(".begin_day").text(vacation.fromDateDotStr);
				$(".end_day").text(vacation.endDateDotStr)
			} else {
				alert(result.message)
			}
		})
	});
	var today = GetDateStr(0);

	function getDays(begin_day, end_day) {
		var separator = "-";
		var oDate1;
		var oDate2;
		var iDays;
		oDate1 = begin_day.split(separator);
		oDate2 = end_day.split(separator);
		var strDateS = new Date(oDate1[0], oDate1[1] - 1, oDate1[2]);
		var strDateE = new Date(oDate2[0], oDate2[1] - 1, oDate2[2]);
		iDays = parseInt(Math.abs(strDateS - strDateE) / 1000 / 60 / 60 / 24);
		return iDays
	}
	$("#holiday_begintime").datepicker({
		dateFormat: "yy-mm-dd",
		minDate: 1,
		onClose: function(selectedDate) {
			$("#holiday_endtime").datepicker("option", "minDate", selectedDate);
			$("#holiday_endtime").val(GetDateStr(8))
		}
	});
	$("#holiday_endtime").datepicker({
		dateFormat: "yy-mm-dd",
		minDate: $("#holiday_begintime").val()
	});
	$("#holiday_cancle").click(function() {
		$(".select_holiday_time").slideUp();
		$("#holiday_begintime").val(GetDateStr(1));
		$("#holiday_endtime").val(GetDateStr(8))
	});
	$("#cancle_holiday_select").click(function() {
		$("#holiday_time").slideUp();
		$("#holiday_endtime").datepicker("option", "minDate", GetDateStr(1));
		$("#holiday_begintime").val(GetDateStr(1));
		$("#holiday_endtime").val(GetDateStr(8));
		$(".isVacation").on("click", "a#holiday_how", holidayHow)
	});
	$("#cancle_happy_decision").click(function() {
		$("#confirm_htime").slideUp();
		$(".isVacation").on("click", "a#holiday_how", holidayHow);
		$("#holiday_begintime").val(GetDateStr(1));
		$("#holiday_endtime").val(GetDateStr(8))
	});
	$("#happy_decision").click(function() {
		holidaAajaxSubmit()
	});

	function holidaAajaxSubmit() {
		var resubmitToken = $("#resubmitToken").val();
		$.ajax({
			type: "POST",
			url: ctx + "Company/addVacation",
			data: {
				fromDate: fromDate,
				endDate: endDate,
				resubmitToken: resubmitToken
			},
			dataType: "json"
		}).done(function(result) {
			if (result.resubmitToken != null || result.resubmitToken != "") {
				$("#resubmitToken").val(result.resubmitToken)
			}
			if (result.state == 1) {
				$(".process_instruction a.holiday_how").css("display", "none");
				$(".process_instruction .isVacation").append('<a class="has_holiday" ff="javascript:;" id="hasVacation"><em></em>已设定休假</a>');
				$("#confirm_htime").slideUp()
			} else {
				alert(result.message)
			}
		})
	}
	$(".isVacation").on("click", "a#hasVacation", function() {
		$("#setVacation").slideToggle("200")
	});
	$("#cancleVacation").click(function() {
		$.ajax({
			type: "POST",
			url: ctx + "Company/cancelVacation",
			dataType: "json"
		}).done(function(result) {
			if (result.state == 1) {
				$("#setVacation").slideUp();
				$(".process_instruction a.has_holiday").hide();
				$(".process_instruction .isVacation").append('<a class="holiday_how"  href="javascript:;" id="holiday_how"><em></em>个人休假怎么办</a>');
				$("#holiday_begintime").val(GetDateStr(1));
				$("#holiday_endtime").val(GetDateStr(8))
			} else {
				alert(result.message)
			}
			$(".isVacation").on("click", "a#holiday_how", holidayHow)
		})
	});

	function holidayHow() {
		$(".process_instruction dl").css("marginBottom", "10px");
		$("#select_holiday_time").slideDown()
	}
	$("#filter_btn2").click(function() {
		if ($(".filter_options").is(":visible")) {
			$("#defaultCondition").val("true");
			$(this).removeClass("filter_current");
			$(".filter_options").hide().prev(".filter_actions").removeClass("btm")
		} else {
			$("#defaultCondition").val("false");
			$(this).addClass("filter_current");
			$(".filter_options").show().prev(".filter_actions").removeClass("btm")
		}
		$("#all_publish").find("ul").hide()
	});
	$(".filter_options dd a").click(function() {
		/*$(this).addClass("current").siblings().removeClass("current");
		var optKey = $(this).attr("rel");
		$(this).siblings('input[type="hidden"]').val(optKey);
		$("#filterForm").submit()*/
	});
	$("#all_publish").click(function(event) {
		var e = event || window.event;
		if ($(this).attr("class") == "filter_current") {
			$(this).find("ul").hide();
			$(this).removeClass("filter_current");
			$(".all_publish").removeClass("all_publish_current");
			$(this).find("i").addClass("resume_triangle_two").removeClass("resume_triangle_one");
			$(this).parents("div.filter_actions").css("z-index", "2")
		} else {
			$(this).find("ul").show();
			$(this).addClass("filter_current");
			$(".all_publish").addClass("all_publish_current");
			$(this).find("i").addClass("resume_triangle_one").removeClass("resume_triangle_two");
			$(this).parents("div.filter_actions").css("z-index", "3")
		}
		e.stopPropagation();
		$("#filter_btn2").removeClass("filter_current");
		$(".filter_options").hide()
	});
	$(".all_publish li").click(function() {
		var text = $(this).text();
		var id = $(this).attr("id");
		$("#all_publish span").text(text);
		$("#all_publish span").attr("title", text);
		$('input[name="publisherId"]').val(id);
		$("#filterForm").submit()
	});
	$("body").click(function() {
		if ($("#all_publish").attr("class") == "filter_current") {
			$("#all_publish").find("ul").hide();
			$("#all_publish").removeClass("filter_current");
			$(".all_publish").removeClass("all_publish_current");
			$("#all_publish i").addClass("resume_triangle_two")
		}
	});
	$("#filter_btn2").click(function() {
		if ($(".filter_options").is(":visible")) {
			$(this).find("i").addClass("resume_triangle_one").removeClass("resume_triangle_two")
		} else {
			$(this).find("i").addClass("resume_triangle_two").removeClass("resume_triangle_one")
		}
	});
	var contactArr = [];
	$(".resume_notice").click(function() {
		$('#hr_noticeInterview input[name="interTime"]').val("");
		$("#notice_select_templete").removeClass("select_focus");
		$("#hr_noticeInterview .boxUpDown").hide();
		var deliverId = $(this).attr("data-deliverId");
		var linkEmail2 = $(this).attr("data-email");
		var positionName = $(this).attr("data-positionName");
		var companyName = $("#noticeCompanyName").val();
		$('#hr_noticeInterview input[name="deliverId"]').val(deliverId);
		$.ajax({
			type: "post",
			url: ctx + "Company/getInterviewTemplates",
			dataType: "json"
		}).done(function(result) {
			var template = eval("(" + result.content.data.templates[0].templateContent + ")");
			if (result.state == 1) {
				$('#hr_noticeInterview input[name="email"]').val(linkEmail2);
				$('#hr_noticeInterview input[name="selectTemplate"]').val(template.alis);
				$('#hr_noticeInterview input[name="name"]').val(result.content.name);
				$('#hr_noticeInterview input[name="subject"]').val(companyName + "：" + positionName + "面试通知").removeClass("error").removeClass("valid");
				$('#hr_noticeInterview input[name="interAdd"]').val(template.interviewAddress).removeClass("error").removeClass("valid");
				$('#hr_noticeInterview input[name="linkPhone"]').val(template.linkPhone).removeClass("error").removeClass("valid");
				$('#hr_noticeInterview input[name="linkMan"]').val(template.linkMan);
				$('#hr_noticeInterview textarea[name="content"]').val(template.content);
				$('#hr_noticeInterview input[name="positionName"]').val(result.content.positionName);
				$('#hr_noticeInterview input[name="companyName"]').val(result.content.companyName);
				$("#hr_noticeInterview span.error").remove();
				$.colorbox({
					inline: true,
					href: $("#hr_noticeInterview"),
					title: "通知面试"
				})
			} else {
				alert(result.message)
			}
		});
		$.ajax({
			type: "post",
			data: {
				deliverId: deliverId
			},
			url: ctx + "Company/getOfflineTemplate",
			dataType: "json"
		}).done(function(result) {
			if (result.state == 1) {
				var temp = result.content.data.template;
				if (temp.contactname) {
					contactArr.push(temp.contactname)
				}
				if (temp.contactphone) {
					contactArr.push(temp.contactphone)
				}
			} else {
				alert(result.message)
			}
		})
	});
	$("#interview_notice_box span").click(function() {
		var me = $(this);
		var index = me.index();
		var box = $(".hr_con");
		me.addClass("interview_notice_selected").removeClass("interview_notice").siblings().addClass("interview_notice");
		box.children().eq(index).show().siblings().hide();
		if ($("#hr_checkContact").css("display") == "block") {
			$("#hr_checkInterviewForm").find("#contactNameInput").val(contactArr[0]);
			$("#hr_checkInterviewForm").find("#contactPhoneInput").val(contactArr[1])
		}
		if (index == 0) {
			$.colorbox({
				inline: true,
				href: $("#hr_noticeInterview"),
				title: "通知面试"
			})
		} else {
			if (index == 1) {
				$.colorbox({
					inline: true,
					href: $("#hr_noticeInterview"),
					title: "标注为“已安排面试”"
				})
			}
		}
	});
	$("#hr_checkInterviewForm").validate({
		focusInvalid: false,
		rules: {
			interTime: {
				required: true
			},
			contactName: {
				required: true,
				rangelength: [2, 16]
			},
			contactPhone: {
				required: true,
				isTel: true,
				maxlength: 30
			}
		},
		messages: {
			interTime: {
				required: "请选择面试时间"
			},
			contactName: {
				required: "请输入联系人",
				rangelength: "请输入2-16个字符的联系人"
			},
			contactPhone: {
				required: "请输入你的联系电话",
				isTel: "请输入正确的手机号或座机号，座机格式如010-62555255或010-6255255-分机号，多个电话用英文逗号隔开",
				maxlength: "请输入30字以内的联系电话"
			}
		},
		submitHandler: function(form) {
			var _form = $(form);
			_form.find(":submit").attr("disabled", "disabled");
			var relationId = $("#hr_noticeInterview").find("#deliverId").val();
			var interviewTime = _form.find('input[name="interTime"]').val();
			_form.find(":submit").attr("disabled", "disabled");
			var linkPhone = _form.find("#contactPhoneInput").val();
			var linkMan = _form.find("#contactNameInput").val();
			$.ajax({
				type: "post",
				dataType: "json",
				url: ctx + "Company/offlineInterview",
				data: {
					relationId: relationId,
					interviewTime: interviewTime,
					linkPhone: linkPhone,
					linkMan: linkMan
				}
			}).done(function(res) {
				if (res.state == 1) {
					top.location.href = top.location.href;
					window.location.reload()
				} else {
					if (res.state == 500) {
						$.colorbox({
							inline: true,
							href: $("#statusChange"),
							title: "简历状态变化"
						})
					} else {
						alert(res.message)
					}
				}
				_form.find(":submit").attr("disabled", false)
			})
		}
	});
	var noticeObj = {};
	$(".notice_templete").click(function() {
		$("#hr_noticeInterview_form span.error").hide();
		$.ajax({
			type: "post",
			url: ctx + "Company/getInterviewTemplates",
			dataType: "json"
		}).done(function(result) {
			if (result.state == 1) {
				var alisLength = eval("(" + result.content.data.templates.length + ")");
				$("#notice_select_templete").parents("span").siblings("div.boxUpDown").show();
				var str = "";
				for (var i = 0; i < alisLength; i++) {
					var templates = eval("(" + result.content.data.templates[i].templateContent + ")");
					str += "<li>" + templates.alis + "</li>";
					noticeObj[templates.alis] = templates
				}
				$("#notice_select_templete").parents("span").siblings("div.boxUpDown").find("ul").html(str);
				$("#notice_select_templete").addClass("select_focus")
			} else {
				alert(result.message)
			}
		})
	});
	$(".select_templete ul").on("click", "li", function() {
		var val = $(this).text();
		if (noticeObj[val] != undefined) {
			content = noticeObj[val];
			$("#notice_select_templete").val(val);
			$('#hr_noticeInterview_form textarea[name="content"]').val(content.content);
			$('#hr_noticeInterview_form input[name="linkPhone"]').val(content.linkPhone);
			$('#hr_noticeInterview_form input[name="linkMan"]').val(content.linkMan);
			$('#hr_noticeInterview_form input[name="interAdd"]').val(content.interviewAddress);
			$("input#notice_select_templete").removeClass("select_focus");
			$(this).parents("div.boxUpDown").hide();
			return false
		}
	});
	$("#hr_noticeInterview_form").click(function() {
		var flag = $(".boxUpDown").hasClass("dn");
		if (flag) {
			$(".boxUpDown").hide();
			$("#notice_select_templete").removeClass("select_focus")
		}
	});
	$("#hr_noticeInterview .emailPreview").bind("click", function() {
		var name = $('#hr_noticeInterview input[name="email"]').val();
		var email = $('#hr_noticeInterview input[name="email"]').val();
		var subject = $('#hr_noticeInterview input[name="subject"]').val();
		var interTime = $('#hr_noticeInterview input[name="interTime"]').val();
		var interAdd = $('#hr_noticeInterview input[name="interAdd"]').val();
		var linkMan = $('#hr_noticeInterview input[name="linkMan"]').val();
		var linkPhone = $('#hr_noticeInterview input[name="linkPhone"]').val();
		var content = $('#hr_noticeInterview textarea[name="content"]').val();
		var pattern = /(^[0-9]{3,4}\-[0-9]{7,8}$)|(^[0-9]{7,8}$)|(^[0-9]{3,4}\-[0-9]{7,8}\-[0-9]{3,5}$)|(^[0-9]{7,8}\-[0-9]{3,5}$)|(^\([0-9]{3,4}\)[0-9]{7,8}$)|(^\([0-9]{3,4}\)[0-9]{7,8}\-[0-9]{3,5}$)|(^0{0,1}[13|15|18|14|17]{2}[0-9]{9}$)/;
		content = content.replace("/\r\n/g", "<br>");
		$("#noticeInterviewPreview .f18").html(subject);
		$("#noticeInterviewPreview .c9 span").html(email);
		var emailText = name + "，您好：<br />您的简历已通过我们的筛选，很高兴通知您参加我们的面试。<br /><br />" + "面试时间：" + interTime + "<br />面试地点：" + interAdd + "<br />";
		if (linkMan != "") {
			emailText += "联系人：" + linkMan + "<br />"
		}
		emailText += "联系电话：" + linkPhone;
		if (content) {
			emailText += "<br /><br />" + content
		}
		$("#emailText").html(emailText);
		var hasError = false;
		if (subject == "" || $('#hr_noticeInterview_form input[name="subject"]').hasClass("error")) {
			hasError = true
		}
		if (interTime == "" || $('#hr_noticeInterview_form input[name="interTime"]').hasClass("error")) {
			hasError = true
		}
		if (interAdd == "" || $('#hr_noticeInterview_form input[name="interAdd"]').hasClass("error")) {
			hasError = true
		}
		if (linkPhone == "" || $('#hr_noticeInterview_form input[name="linkPhone"]').hasClass("error")) {
			hasError = true
		}
		if ($('#hr_noticeInterview_form textarea[name="content"]').hasClass("error")) {
			hasError = true
		}
		if (hasError) {
			$("#noticeInterviewPreview .btn").hide()
		} else {
			$("#noticeInterviewPreview .btn").show()
		}
		$.colorbox({
			inline: true,
			href: $("#noticeInterviewPreview"),
			title: "通知面试"
		})
	});
	$("#hr_noticeInterview_form").validate({
		rules: {
			subject: {
				required: true,
				maxlength: 200
			},
			interTime: {
				required: true
			},
			interAdd: {
				required: true,
				maxlength: 200
			},
			linkMan: {
				required: true,
				rangelength: [2, 16]
			},
			linkPhone: {
				required: true,
				isTel: true,
				maxlength: 30
			},
			content: {
				required: false,
				maxlength: 500
			}
		},
		messages: {
			subject: {
				required: "请输入你的主题",
				maxlength: "请输入200字符以内的主题"
			},
			interTime: {
				required: "请输入你的面试时间"
			},
			interAdd: {
				required: "请输入你的面试地点",
				maxlength: "请输入200字符以内的面试地点"
			},
			linkPhone: {
				required: "请输入你的联系电话",
				isTel: "请输入正确的手机号或座机号，座机格式如010-62555255或010-6255255-分机号，多个电话用英文逗号隔开",
				maxlength: "请输入30字以内的联系电话"
			},
			linkMan: {
				required: "请输入联系人",
				rangelength: "请输入2-16个字符的联系人"
			},
			content: {
				maxlength: "请输入500字符以内的补充内容"
			}
		},
		submitHandler: function(form) {
			var _form = $(form);
			_form.find(":submit").attr("disabled", "disabled");
			var subject = $('input[name="subject"]', form).val();
			var interTime = $('input[name="interTime"]', form).val();
			var interAdd = $('input[name="interAdd"]', form).val();
			var linkMan = $('input[name="linkMan"]', form).val();
			var linkPhone = $('input[name="linkPhone"]', form).val();
			var content = $('textarea[name="content"]', form).val();
			var deliverId = $('input[name="deliverId"]', form).val();
			var resubmitToken = $("#resubmitToken").val();
			$.ajax({
				type: "POST",
				data: {
					title: subject,
					interviewTime: interTime,
					interAdd: interAdd,
					linkMan: linkMan,
					linkPhone: linkPhone,
					content: content,
					deliverId: deliverId,
					resubmitToken: resubmitToken
				},
				url: ctx + "Company/onlineInterview",
				dataType: "json",
				beforeSend: function() {
					_form.find(":submit").attr("disabled", "disabled")
				}
			}).done(function(result) {
				if (null != result.resubmitToken && "" != result.resubmitToken) {
					$("#resubmitToken").val(result.resubmitToken)
				}
				if (result.state == 1) {
					$.colorbox({
						inline: true,
						href: $("#noticeInterviewSuccess"),
						title: "通知面试"
					})
				} else {
					if (result.state == 500) {
						$.colorbox({
							inline: true,
							href: $("#statusChange"),
							title: "简历状态变化"
						})
					} else {
						alert(result.message)
					}
				}
				_form.find(":submit").attr("disabled", false)
			})
		}
	});
	$("#noticeInterviewPreview .btn").bind("click", function() {
		$("#hr_noticeInterview_form").submit()
	});
	$("#datetimepicker").datetimepicker({
		showMonthAfterYear: true,
		controlType: "select",
		minDate: 0,
		hourMin: 7,
		hourMax: 23,
		stepMinute: 10,
		dateFormat: "yy-mm-dd"
	});
	$("#datetimepicker").focus(function() {
		var length = $("#datetimepicker").val().length;
		if (length != 0) {
			$("#datetimepicker").siblings("span").hide()
		}
	});
	$("#interviewtime").datetimepicker({
		showMonthAfterYear: true,
		controlType: "select",
		hourMin: 7,
		hourMax: 23,
		stepMinute: 10,
		dateFormat: "yy-mm-dd"
	});
	$("#interviewtime").focus(function() {
		var length = $("#interviewtime").val().length;
		if (length != 0) {
			$("#interviewtime").siblings("span").hide()
		}
	});
	var refuseObj = {};
	$(".selectRefuse").click(function() {
		$("#refuseMailForm span.error").hide();
		$.ajax({
			type: "post",
			url: ctx + "Company/getRefuseTemplates",
			dataType: "json"
		}).done(function(result) {
			if (result.state == 1) {
				var alisLength = result.content.data.templates.length;
				$("#refuse_select_templete").parents("span").siblings("div.boxUpDown").show();
				var str = "";
				for (var i = 0; i < alisLength; i++) {
					templates = result.content.data.templates[i];
					str += "<li>" + templates.alis + "</li>";
					refuseObj[templates.alis] = eval("(" + templates.templateContent + ")")
				}
				$("#refuse_select_templete").parents("span").siblings("div.boxUpDown").find("ul").html(str);
				$("#refuse_select_templete").addClass("select_focus")
			} else {
				alert(result.message)
			}
		})
	});
	$(".select_templete2 ul").on("click", "li", function(e) {
		e.stopPropagation();
		var val = $(this).text();
		for (var alis in refuseObj) {
			if (alis == val) {
				content = refuseObj[val];
				$("#refuse_select_templete").val(alis);
				$('#refuseMailForm textarea[name="content"]').val(content.content);
				$("input#refuse_select_templete").removeClass("select_focus");
				$(this).parents("div.boxUpDown").hide();
				return false
			}
		}
	});
	$("#confirmRefuse").click(function() {
		var flag = $(".boxUpDown").hasClass("dn");
		if (flag) {
			$(".boxUpDown").hide();
			$("#refuse_select_templete").removeClass("select_focus")
		}
	});
	$("#refuseMailForm").validate({
		rules: {
			content: {
				required: true,
				maxlength: 200
			}
		},
		messages: {
			content: {
				required: "请输入你的邮件内容",
				maxlength: "请输入200字符以内的邮件内容"
			}
		},
		submitHandler: function(form) {
			var _form = $(form);
			_form.find(":submit").attr("disabled", "disabled");
			var content = $('textarea[name="content"]', form).val();
			var deliverId = $('input[name="deliverId"]', form).val();
			var resubmitToken = $("#resubmitToken").val();
			$.ajax({
				url: ctx + "Company/hrRefuse",
				type: "POST",
				data: {
					content: content,
					deliverIds: deliverId,
					resubmitToken: resubmitToken
				},
				dataType: "json",
				beforeSend: function() {
					_form.find(":submit").attr("disabled", "disabled")
				}
			}).done(function(result) {
				if (null != result.resubmitToken && "" != result.resubmitToken) {
					$("#resubmitToken").val(result.resubmitToken)
				}
				if (result.state == 5) {
					top.location.href = top.location.href;
					window.location.reload()
				} else {
					if (result.state == 3) {
						$.colorbox({
							inline: true,
							href: $("#statusChange"),
							title: "简历状态变化"
						})
					} else {
						alert(result.message)
					}
				}
				_form.find(":submit").attr("disabled", false)
			})
		}
	});
	$(".resume_refuse").bind("click", function() {
		$("#refuse_select_templete").removeClass("select_focus");
		$("#refuseMailForm .boxUpDown").hide();
		var deliverId = $(this).attr("data-deliverId");
		$('#refuseMailForm input[name="deliverId"]').val(deliverId);
		$.ajax({
			url: ctx + "Company/getRefuseTemplates",
			dataType: "json",
			type: "POST"
		}).done(function(result) {
			var template = eval("(" + result.content.data.templates[0].templateContent + ")");
			if (result.state == 1) {
				$("#refuseMailForm input#refuse_select_templete").val(template.alis);
				$("#refuseMailForm textarea").val(template.content).removeClass("error").removeClass("valid");
				$("#refuseMailForm span.error").remove()
			}
			$.colorbox({
				inline: true,
				href: $("#confirmRefuse"),
				title: "确认简历不合适"
			})
		})
	});
	$(document).click(function() {
		$(".send_notice_tips").hide();
		$("#datetimepicker").blur()
	});
	$(".click_bf").click(function(e) {
		e.stopPropagation();
		var flag = $(this).find(".up_tip").attr("data-flag");
		$(".resume_lists li[data-flag = '" + flag + "'] .send_notice .send_notice_tips").show()
	});
	$("#mianshiYear").datetimepicker({
		showMonthAfterYear: true,
		controlType: "select",
		hourMin: 7,
		hourMax: 23,
		stepMinute: 10,
		dateFormat: "yy-mm-dd"
	});
	$(".has_notice").click(function(e) {
		$(".send_notice_tips").hide();
		$('#hasOfflineNoticeForm input[name="noticeTime"]').val("");
		$("#offlineDeliverId").val($(this).attr("data-deliverid"));
		$('#hasOfflineNoticeForm input[name="noticeTime"]').siblings("span.error").hide();
		e.stopPropagation();
		var deliverId = $(this).attr("data-deliverId");
		$.colorbox({
			inline: true,
			href: $("#hasOfflineNotice"),
			title: "标注为“已安排面试”"
		})
	});
	$("#colorbox").on("click", "#cboxClose", function() {
		if ($(this).siblings("#cboxLoadedContent").children("div").attr("id") == "hasOfflineNotice") {
			$(".send_notice_tips").hide()
		}
	});
	$("#hasOfflineNoticeForm").validate({
		focusInvalid: false,
		rules: {
			noticeTime: {
				required: true
			}
		},
		messages: {
			noticeTime: {
				required: "请选择面试时间"
			}
		},
		submitHandler: function(form) {
			var _form = $(form);
			_form.find(":submit").attr("disabled", "disabled");
			var relationId = $("#offlineDeliverId").val();
			var interviewTime = $('#hasOfflineNotice input[name="noticeTime"]').val();
			$.ajax({
				type: "post",
				url: ctx + "Company/offlineInterview",
				data: {
					relationId: relationId,
					interviewTime: interviewTime
				},
				dataType: "json",
				beforeSend: function() {
					_form.find(":submit").attr("disabled", "disabled")
				}
			}).done(function(result) {
				if (result.state == 1) {
					$.colorbox.close();
					var relationId = $("#offlineDeliverId").val();
					$(".resume_lists li[data-flag ='" + relationId + "'] .send_notice").hide();
					$(".resume_lists li[data-flag = '" + relationId + "'] .resume_fit_forward").show();
					$(".resume_lists li[data-flag = '" + relationId + "'] .resume_header2 .checkbox").css("background", "#efefef");
					$(".resume_lists li[data-flag = '" + relationId + "'] .resume_header2 .checkbox input[type='checkbox']").prop("disabled", "true")
				} else {
					if (result.state == 500) {
						$.colorbox({
							inline: true,
							href: $("#statusChange"),
							title: "简历状态变化"
						})
					} else {
						alert(result.message)
					}
				}
				_form.find(":submit").attr("disabled", false)
			})
		}
	});
	$("#hasOfflineNotice .cancel").click(function() {
		$.colorbox.close();
		$(".send_notice_tips").hide();
		$('#hasOfflineNoticeForm input[name="noticeTime"]').siblings("span.error").hide();
		$('#hasOfflineNoticeForm input[name="noticeTime"]').val("")
	});
	$("#colorbox").on("click", ".cancelLink", function() {
		$.colorbox.close()
	});
	$("#colorbox").on("click", ".cancelPreview", function() {
		$.colorbox.close()
	});
	$("#resumeRefuseAll").click(function() {
		var flag = false;
		$(".resume_lists li").each(function() {
			if (!$(".checkbox input", this).prop("disabled")) {
				flag = true
			}
		});
		if (!flag) {
			$(".filter_actions .checkbox").css("background", "#efefef");
			$(".filter_actions .checkbox input").prop("disbaled", "true");
			return
		}
		var deliverIds = new Array();
		var resubmitToken = $("#resubmitToken").val();
		$(".resume_lists li").each(function() {
			if ($(this).find('input[type="checkbox"]').attr("checked")) {
				deliverIds.push($(this).attr("data-flag"))
			}
		});
		var listLen = $(".resume_lists li").length;
		var delCount = deliverIds.length;
		deliverIds = deliverIds.join(",");
		if (deliverIds == "") {
			alert("请选择要标记的简历");
			return false
		}
		if (confirm("确定要标记选中的简历为不合适简历吗？确认后系统将自动发送拒绝信至用户邮箱")) {
			$.ajax({
				type: "POST",
				url: ctx + "Company/hrRefuse",
				data: {
					deliverIds: deliverIds,
					resubmitToken: resubmitToken
				},
				dataType: "json"
			}).done(function(result) {
				$("#resubmitToken").val(result.resubmitToken);
				if (result.state == 5) {
					var pageNo = parseInt($("#pageNo").val());
					var totalPageCount = parseInt($("#totalPageCount").val());
					if (pageNo > 1) {
						$("#pageNo").val(pageNo - 1);
						var prevPage = $("#pageNo").val();
						var href = window.location.href;
						var hrefParams = href.split("&");
						var curPage;
						for (var i = 1; i < hrefParams.length; i++) {
							var params = hrefParams[i].split("=");
							if (params[0] == "pageNo") {
								curPage = params[1];
								break
							}
						}
						if (href.substr(href.length - 1) == curPage && listLen == delCount) {
							href = href.substr(0, href.length - 1) + prevPage
						}
						window.location.href = href
					} else {
						top.location.href = top.location.href;
						window.location.reload()
					}
				} else {
					alert(result.message)
				}
			})
		} else {
			return false
		}
	});
	$(".filter_actions .checkbox input").bind("click", function() {
		if ($(this).attr("checked")) {
			$(this).removeAttr("checked");
			$(this).siblings("i").fadeOut(200);
			$(".resume_lists li").each(function() {
				$(".checkbox i", this).fadeOut(200);
				$(".checkbox input", this).removeAttr("checked");
				$(".checkbox", this).removeClass("checkhover")
			})
		} else {
			$(this).attr("checked", "checked");
			$(this).siblings("i").fadeIn(200);
			$(".resume_lists li").each(function() {
				if ($(".checkbox input", this).prop("disabled")) {
					$(".checkbox i", this).fadeOut(200)
				} else {
					$(".checkbox i", this).fadeIn(200)
				}
				$(".checkbox input", this).attr("checked", "checked");
				$(".checkbox", this).removeClass("checkhover")
			})
		}
		$(this).parent().removeClass("checkhover");
		return false
	});
	$(".resume_lists .checkbox input").bind("click", function() {
		if ($(this).attr("checked")) {
			$(this).removeAttr("checked");
			$(this).siblings("i").fadeOut(200);
			var check = false;
			$(".filter_actions .checkbox input").removeAttr("checked").siblings("i").fadeOut(200);
			$(".resume_lists li").each(function() {
				if ($(".checkbox input", this).attr("checked")) {
					check = true
				}
			});
			if (!check) {
				$(".filter_actions .checkbox input").removeAttr("checked").siblings("i").fadeOut(200)
			}
		} else {
			$(this).attr("checked", "checked");
			$(this).siblings("i").fadeIn(200)
		}
		$(this).parent().removeClass("checkhover");
		return false
	});
	$(".checkbox").hover(function() {
		if (!$(this).children("input").attr("checked")) {
			$(this).addClass("checkhover")
		}
	}, function() {
		if (!$(this).children("input").attr("checked")) {
			$(this).removeClass("checkhover")
		}
	});
	$(".resume_del").bind("click", function() {
		var _this = $(this);
		var deliverId = _this.parents("li").attr("data-flag");
		var resubmitToken = $("#resubmitToken").val();
		if (confirm("确定要删除该简历吗？")) {
			$.ajax({
				type: "POST",
				url: ctx + "Company/deleteRefuse",
				data: {
					deliverIds: deliverId,
					resubmitToken: resubmitToken
				},
				dataType: "json"
			}).done(function(result) {
				$("#resubmitToken").val(result.resubmitToken);
				if (result.state == 3) {
					top.location.href = top.location.href;
					window.location.reload()
				} else {
					alert(result.message)
				}
			})
		} else {
			return false
		}
	});
	$("#resumeDelAll").bind("click", function() {
		var resumeId = new Array();
		var resubmitToken = $("#resubmitToken").val();
		$(".resume_lists li").each(function() {
			if ($(this).find('input[type="checkbox"]').attr("checked")) {
				resumeId.push($(this).attr("data-flag"))
			}
		});
		var listLen = $(".resume_lists li").length;
		var delCount = resumeId.length;
		resumeId = resumeId.join(",");
		if (delCount == 0) {
			alert("请选择要删除的简历");
			return false
		}
		if (confirm("确定要删除选中的简历吗？")) {
			$.ajax({
				type: "POST",
				url: ctx + "Company/deleteRefuse",
				data: {
					deliverIds: resumeId,
					resubmitToken: resubmitToken
				},
				dataType: "json"
			}).done(function(result) {
				$("#resubmitToken").val(result.resubmitToken);
				if (result.state == 3) {
					var pageNo = parseInt($("#pageNo").val());
					var totalPageCount = parseInt($("#totalPageCount").val());
					if (pageNo > 1) {
						$("#pageNo").val(pageNo - 1);
						var prevPage = $("#pageNo").val();
						var href = window.location.href;
						var hrefParams = href.split("&");
						var curPage;
						for (var i = 1; i < hrefParams.length; i++) {
							var params = hrefParams[i].split("=");
							if (params[0] == "pageNo") {
								curPage = params[1];
								break
							}
						}
						if (href.substr(href.length - 1) == curPage && listLen == delCount) {
							href = href.substr(0, href.length - 1) + prevPage
						}
						window.location.href = href
					} else {
						top.location.href = top.location.href;
						window.location.reload()
					}
				} else {
					alert(result.message)
				}
			})
		} else {
			return false
		}
	});
	$(".i_konw").click(function() {
		$.colorbox.close();
		$("#guide_line").fadeOut("600")
	});
	$("#colorbox").on("click", "#cboxClose", function() {
		if ($(this).siblings("#cboxLoadedContent").children("div").attr("id") == "reached_limit") {
			$("#guide_line").fadeOut("600")
		}
	});
	$(".resume_lists a.resume_forward").on("click", "dl", function() {
		return false
	});
	$("#forwardResumeForm").validate({
		rules: {
			recipients: {
				required: true,
				moreEmail: true,
				maxlength: 100
			},
			title: {
				required: true,
				maxlength: 200
			},
			content: {
				required: true,
				maxlength: 500
			}
		},
		messages: {
			recipients: {
				required: "请输入收件人的邮件地址",
				moreEmail: "请输入有效的收件人的邮件地址，最多2个，并用;隔开",
				maxlength: "请输入100字以内的邮箱地址"
			},
			title: {
				required: "请输入你的主题",
				maxlength: "请输入200字符以内的主题"
			},
			content: {
				required: "请输入你的正文",
				maxlength: "请输入500字符以内的正文"
			}
		},
		submitHandler: function(form) {
			var recipients = $('input[name="recipients"]', form).val();
			var title = $('input[name="title"]', form).val();
			var content = $('textarea[name="content"]', form).val();
			var deliverId = $('input[name="deliverId"]', form).val();
			var resubmitToken = $("#resubmitToken").val();
			$.ajax({
				type: "POST",
				url: ctx + "Company/forward",
				data: {
					recipients: recipients,
					title: title,
					content: content,
					deliverId: deliverId,
					resubmitToken: resubmitToken
				},
				dataType: "json"
			}).done(function(result) {
				if (null != result.resubmitToken && "" != result.resubmitToken) {
					$("#resubmitToken").val(result.resubmitToken)
				}
				if (result.state == 1) {
					$.colorbox({
						inline: true,
						href: $("#forwardResumeSuccess"),
						title: "转发简历"
					})
				} else {
					$("#forwardResumeError").html(result.msg).addClass("error");
					$("#forwardResumeForm .beError").html(result.msg).show()
				}
			})
		}
	});
	$(".resume_forward").bind("click", function() {
		$(this).children("dl").hide();
		var positionName = $(this).attr("data-positionName");
		var resumeKey = $(this).attr("data-resumeKey");
		var positionId = $(this).attr("data-positionId");
		var deliverId = $(this).attr("data-deliverId");
		var title = "（简历来自Jobsminer乔麦）" + $(this).attr("data-positionName") + "：" + $(this).attr("data-resumeName");
		var content = "以下是应聘“" + $(this).attr("data-positionName") + "”的简历。我已查阅，请您评估一下。 若觉合适，我们将安排面试，谢谢！";
		var lastForwardEmail = "";
		$.ajax({
			type: "GET",
			async: false,
			url: ctx + "/forward/lastForwardRecord.json",
			data: {
				"deliverId": deliverId
			},
			dataType: "json"
		}).done(function(result) {
			if (null != result) {
				if (result.state == 101 || result.state == 102) {
					console.log(result.message)
				} else {
					if (result.state == 1) {
						title = result.content.data.lastForwardRecord.title;
						content = result.content.data.lastForwardRecord.content;
						lastForwardEmail = result.content.data.lastForwardRecord.recipients
					}
				}
			}
		});
		$('#forwardResumeForm input[name="positionName"]').val(positionName);
		$('#forwardResumeForm input[name="resumeKey"]').val(resumeKey);
		$('#forwardResumeForm input[name="positionId"]').val(positionId);
		$('#forwardResumeForm input[name="deliverId"]').val(deliverId);
		$('#forwardResumeForm input[name="title"]').val(title).removeClass("error").removeClass("valid");
		$('#forwardResumeForm textarea[name="content"]').val(content).removeClass("error").removeClass("valid");
		$("#forwardResumeForm span.error").remove();
		$("#recipients").val("");
		placeholderFn();
		suggestEmail("recipients");
		$("#recipients").val(lastForwardEmail);
		$.colorbox({
			inline: true,
			href: $("#forwardResume"),
			title: "转发简历"
		})
	});
	$(".resume_lists li  a.resume_forward").hover(function() {
		$(this).css("z-index", "8");
		var _this = $(this);
		var count = _this.attr("data-forwardCount");
		var id = _this.attr("data-deliverId");
		if (count != 0) {
			if (_this.find("dl").length == 1) {
				_this.find("dl").show()
			} else {
				$.ajax({
					url: ctx + "Company/showForwardEmails",
					type: "POST",
					data: {
						deliverId: id
					},
					dataType: "json"
				}).done(function(result) {
					if (result.state == 1) {
						var html = "<dl><dt>已转发给：</dt><dd><ul>";
						for (var i = 0; i < result.content.data.emails.length; i++) {
							html += "<li>" + result.content.data.emails[i] + "</li>"
						}
						html += "</ul></dd></dl>";
						_this.append(html)
					} else {
						alert(result.message)
					}
				})
			}
		}
	}, function() {
		$(this).css("z-index", "0");
		$(this).find("dl").hide()
	});

	function split(val) {
		val.replace("；", ";");
		return val.split(/;\s*/)
	}
	function extractLast(term) {
		return split(term).pop()
	}
	function suggestEmail(input) {
		var availableTags = "";
		$.ajax({
			type: "GET",
			async: false,
			url: ctx + "/forward/forwardSuggest.json",
			dataType: "json"
		}).done(function(result) {
			availableTags = result.content
		});
		$("#" + input).autocomplete({
			source: function(request, response) {
				response($.ui.autocomplete.filter(availableTags, extractLast(request.term)))
			},
			focus: function() {
				return false
			},
			select: function(event, ui) {
				var terms = split(this.value);
				terms.pop();
				terms.push(ui.item.value);
				terms.push("");
				this.value = terms.join("; ");
				return false
			}
		})
	}
	$(".notice_noprompt").click(function() {
		if ($("#noPrompt").prop("checked")) {
			$(".notice_noprompt em").css("backgroundPosition", "0px 0px");
			$("#noPrompt").prop("checked", false);
			$(".lp_agreeNotice").next("span").show()
		} else {
			$("#noPrompt").prop("checked", true);
			$(".notice_noprompt").next("span").hide();
			$(".notice_noprompt em").css("backgroundPosition", "0px -12px")
		}
	});
	$("#resume_empty").click(function() {
		if (!$.cookie("noNotice2")) {
			$.colorbox({
				inline: true,
				href: $("#empty_resume"),
				title: "清空“不合适”中的简历"
			});
			$("#empty_resume #confirmEmpty").click(function() {
				noPrompt();
				if ($("#noPrompt").prop("checked")) {
					$.cookie("noNotice2", "noticeValue", {
						expires: 7
					})
				}
			})
		} else {
			noPrompt()
		}
	});

	function noPrompt() {
		$.ajax({
			type: "post",
			url: ctx + "/refuse/clear.json",
			dataType: "json"
		}).done(function(result) {
			if (result.state == 3) {
				top.location.href = top.location.href;
				window.location.reload()
			} else {
				alert(result.message)
			}
		})
	}
	$("#colorbox").on("click", "#cboxClose", function() {
		if ($(this).siblings("#cboxLoadedContent").children("div").attr("id") == "forwardResumeSuccess") {
			top.location.href = top.location.href;
			window.location.reload()
		}
	});
	$("#colorbox").on("click", "#cboxClose", function() {
		if ($(this).siblings("#cboxLoadedContent").children("div").attr("id") == "noticeInterview") {
			$('#noticeInterview input[name="interTime"]').val("")
		}
	});
	$("#colorbox").on("click", "#cboxClose", function() {
		if ($(this).siblings("#cboxLoadedContent").children("div").attr("id") == "hasOfflineNotice") {
			$('#hasOfflineNotice input[name="noticeTime"]').val("")
		}
	});
	$("#forwardResumeSuccess .btn,#noticeInterviewSuccess .btn,#refuseMailSuccess .btn").bind("click", function() {
		top.location.href = top.location.href;
		window.location.reload()
	});
	$(".emial_cancel").bind("click", function() {
		$.colorbox.close();
		parent.jQuery.colorbox.close()
	});
	$(".resume_download").bind("click", function() {
		$.colorbox({
			inline: true,
			href: $("#downloadOnlineResume"),
			title: "下载简历"
		})
	});
	$("#weixinQR .btn_s,#weixinQR .qr_cancel").click(function() {
		var myDate = new Date();
		$.cookie("showQRCode", myDate.getDate(), {
			expired: 180
		});
		$.colorbox.close();
		parent.jQuery.colorbox.close()
	});
	$(".look_resume_link span").bind("click", function() {
		$("#checkInterviewForm span.error").hide();
		var me = $(this);
		var id = me.attr("data-deliverId");
		$("#checkInterviewForm").find("#deliverId").val(id);
		$.ajax({
			type: "post",
			url: ctx + "Company/checkShow",
			data: {
				id: id
			},
			dataType: "json"
		}).done(function(result) {
			if (result.state == 1) {
				/*$.colorbox({
					inline: true,
					href: $("#checkContact"),
					title: "查看联系方式"
				});
				$("#checkContact").find('input[name="deliverId"]').val(id)*/
				
				//console.log(result.content.data.email);
				
				//alert(result.content.data.email+"<br />"+result.content.data.phone);
				var hhh = '<span class="inline" style="cursor: auto;">'+result.content.data.email+"<br />"+result.content.data.phone+'</span>';
				$("#look_resume_link_"+id).html(hhh);
				$("#mxuqiao").trigger("click");
				
				
				$.ajax({url:"/Company/showContact/?id="+id,async:false});
				
				
				
				//top.location.href = top.location.href;
				//window.location.reload();
				
			} else {
				if (result.state == 301) {
					var pageType = $("#pageType").val();
					if (pageType == "1") {
						var pubName = result.message;
						pubName = pubName.split("$$$")[0];
						$("#autoFilter_reached_limit span").text(pubName + "的");
						$.colorbox({
							inline: true,
							href: $("#autoFilter_reached_limit"),
							title: "待沟通简历到达上限"
						})
					} else {
						var publisherName = $("#publisherName" + id).val();
						if (publisherName != undefined && publisherName != "") {
							var publisher = publisherName.split("@")[0];
							$("#big_reached_limit").find("span").html(publisher + "的");
							$.colorbox({
								inline: true,
								href: $("#big_reached_limit"),
								title: "待沟通简历到达上限"
							})
						} else {
							$("#guide_line").fadeIn("600");
							var lineHeight = $(document).scrollTop();
							$("body").css("position", "relative");
							$("#guide_line").css({
								"position": "absolute",
								"top": 300 + lineHeight,
								"left": "950px",
								"z-index": "99999"
							});
							var pubName = result.message;
							pubName = pubName.split("$$$")[0];
							$("#reached_limit span").text(pubName + "的");
							$.colorbox({
								inline: true,
								href: $("#reached_limit"),
								title: "待沟通简历到达上限"
							})
						}
					}
					return false
				} else {
					$.colorbox({
						inline: true,
						href: $("#statusChange"),
						title: "简历状态变化"
					});
					return false
				}
			}
		});
		
		
		return false;
		
		
		var checkContact = $("#checkContact");
		$.ajax({
			type: "post",
			url: ctx + "Company/getTemplate",
			data: {},
			dataType: "json"
		}).done(function(result) {
			var res = result.content.data.template;
			if (result.state == "1") {
				if (res.contactName) {
					checkContact.find('input[name="contactName"]').val(res.contactName)
				}
				if (res.contactPhone) {
					checkContact.find('input[name="contactPhone"]').val(res.contactPhone)
				}
				if (res.contactEmail) {
					checkContact.find('input[name="contactEmail"]').val(res.contactEmail)
				}
			} else {
				alert(result.message)
			}
		})
	});
	var urlEle = window.location.href;

	function requestGetUrlEle(paras) {
		var url = location.href;
		var paraString = url.substring(url.indexOf("?") + 1, url.length).split("&");
		var paraObj = {};
		for (i = 0; j = paraString[i]; i++) {
			paraObj[j.substring(0, j.indexOf("=")).toLowerCase()] = j.substring(j.indexOf("=") + 1, j.length)
		}
		var returnValue = paraObj[paras.toLowerCase()];
		if (typeof(returnValue) == "undefined") {
			return ""
		} else {
			return returnValue
		}
	}
	var star = $(".resume_header2").find(".star");
	var moreFilter = $(".more_filter");
	var condation = $(".filter_options");
	var temp;
	var dl = condation.find('dl:not(":first")');
	moreFilter.on("click", function() {
		if (dl.hasClass("dn")) {
			dl.removeClass("dn");
			$("#filtera").val("1");
			window.location.hash = "1"
		} else {
			dl.addClass("dn");
			$("#filtera").val("0");
			window.location.hash = "0"
		}
	});
	star.on("click", function() {
		var me = $(this);
		var deliverId = me.attr("data-deliverId");
		var flag = me.hasClass("collect");
		$.ajax({
			type: "post",
			data: {
				deliverId: deliverId,
				mark: !flag
			},
			url: ctx + "Company/mark",
			dataType: "json"
		}).done(function(res) {
			if (res.state == 1) {
				flag ? me.removeClass("collect") : me.addClass("collect")
			}
		})
	});
	$(".filter_options dd a").on("click", function() {
		/*$(this).addClass("current").siblings().removeClass("current");
		var optKey = $(this).attr("rel");
		$(this).siblings('input[type="hidden"]').val(optKey);
		$("#filterForm").submit()*/
	});
	requestGetUrlEle("filtera");
	if (window.location.hash == "#1") {
		dl.removeClass("dn");
		$("#filtera").val("1")
	} else {
		if (window.location.hash == "#0") {
			dl.addClass("dn");
			$("#filtera").val("0")
		} else {
			if (requestGetUrlEle("filtera") == 1) {
				dl.removeClass("dn");
				$("#filtera").val("1")
			} else {
				dl.addClass("dn");
				$("#filtera").val("0")
			}
		}
	}
	$("#checkInterviewForm").validate({
		focusInvalid: false,
		rules: {
			contactName: {
				required: true,
				rangelength: [2, 16]
			},
			contactPhone: {
				required: true,
				isTel: true,
				maxlength: 30
			},
			contactEmail: {
				required: true,
				email: true,
				maxlength: 100
			}
		},
		messages: {
			contactName: {
				required: "请输入联系人",
				rangelength: "请输入2-16个字符的联系人"
			},
			contactPhone: {
				required: "请输入你的联系电话",
				isTel: "请输入正确的手机号或座机号，座机格式如010-8004567或010-8004567-分机号，多个电话用英文逗号隔开",
				maxlength: "请输入30字以内的联系电话"
			},
			contactEmail: {
				required: "请输入你的联系邮箱",
				email: "请输入有效的邮箱地址，如：service@jobsminer.cc",
				maxlength: "请输入100字以内的联系邮箱"
			}
		},
		submitHandler: function(form) {
			var contactName = $.trim($('input[name="contactName"]', form).val());
			var contactPhone = $.trim($('input[name="contactPhone"]', form).val());
			var contactEmail = $.trim($('input[name="contactEmail"]', form).val());
			var id = $.trim($('input[name="deliverId"]', form).val());
			$.ajax({
				type: "post",
				url: ctx + "Company/showContact",
				data: {
					id: id,
					contactPhone: contactPhone,
					contactName: contactName,
					contactEmail: contactEmail
				},
				dataType: "json"
			}).done(function(result) {
				if (result.state == 1) {
					var pageType = $("#pageType").val();
					$(".resume_lists li[data-flag = '" + id + "'] .look_resume_link").empty();
					$(".resume_lists li[data-flag = '" + id + "'] .look_resume_link").append('<a href="javascript:;" class="phone">' + result.content.data.phone + '</a><a href="javascript:;" class="resume_color phone" title="' + result.content.data.email + '">' + result.content.data.email + "</a>");
					$(".resume_lists li[data-flag = '" + id + "'] .look_resume_link").css("padding", "20px 0px");
					$(".resume_lists li[data-flag = '" + id + "'] .send_notice .resume_notice").attr("data-email", result.content.data.email);
					$(".resume_lists li[data-flag = '" + id + "'] .resume_link").append('<div class="resume_tips dn">刷新页面后，该简历会移入待沟通</div>');
					var _this = $(".resume_lists li[data-flag = '" + id + "'] .resume_tips");
					_this.show();
					setTimeout(function() {
						_this.fadeOut("200")
					}, 3000);
					$(".resume_lists li[data-flag = '" + id + "'] .resume_fit_forward").hide();
					$(".resume_lists li[data-flag = '" + id + "'] .look_resume_fit").show();
					$(".resume_lists li[data-flag = '" + id + "'] .look_resume_fit .block").show().css({
						"display": "block",
						"textAlign": "center"
					});
					$.colorbox.close()
				} else {
					if (result.state == "301") {
						$.colorbox({
							inline: true,
							href: $("#reachLimit"),
							title: "待沟通简历数量已达到上限"
						})
					} else {
						if (result.state >= 401 && result.state <= 404) {
							alert(result.message)
						} else {
							$.colorbox({
								inline: true,
								href: $("#statusChange"),
								title: "简历状态变化"
							})
						}
					}
				}
			})
		}
	});
	$("#reached_limit .btn").click(function() {
		$.colorbox.close()
	});
	$("#reachLimit .btn").click(function() {
		$.colorbox.close()
	});
	$("#statusChange .btn").click(function() {
		top.location.href = top.location.href;
		window.location.reload()
	});
	$("#colorbox").on("click", "#cboxClose", function() {
		if ($(this).siblings("#cboxLoadedContent").children("div").attr("id") == "statusChange") {
			top.location.href = top.location.href;
			window.location.reload()
		}
	});

	function popQR() {
		$.ajax({
			url: ctx + "/mycenter/showQRCode",
			type: "GET"
		}).done(function(data) {
			if (data.success) {
				$("#weixinQR .qr img").attr("src", data.content);
				$.colorbox({
					inline: true,
					href: $("#weixinQR"),
					title: "关注微信服务号"
				})
			}
		})
	}
	function highlight() {
		var height = $("#filterForm ul.resume_lists li").eq(0).height();
		$("#filterForm ul.resume_lists").prepend('<li class="borderHighlight"></li>');
		$("#filterForm ul.resume_lists li.borderHighlight").css("height", height).fadeIn(400).delay(2500).fadeOut(400)
	}
	$(".resume_feedback em").hover(function() {
		$(this).find("span").show()
	}, function() {
		$(this).find("span").hide()
	});
	$(".click_af").click(function() {
		$(this).parents("div.send_notice_tips").hide()
	});
	$(".send_notice_tips div").hover(function() {
		$(this).addClass("acticeHover");
		$(this).find(".send_interview").addClass("activeHover");
		$(this).find(".dw_tip").addClass("emActive")
	}, function() {
		$(this).removeClass("acticeHover");
		$(this).find(".send_interview").removeClass("activeHover");
		$(this).find(".dw_tip").removeClass("emActive")
	});
	(function() {
		$(function() {
			var resume_num = 0;
			$("#resume_select").bind("click", function() {
				if (resume_num == 1) {
					$(this).find("em").css("transform", "rotate(0deg)");
					$(".resume_notice_hide").animate({
						top: "-13px"
					}, "normal");
					resume_num = 0
				} else {
					$(this).find("em").css("transform", "rotate(180deg)");
					$(".resume_notice_hide").animate({
						top: "-49px"
					}, "normal");
					resume_num++
				}
			})
		})
	})()
});